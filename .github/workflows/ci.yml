name: CI

on:
  push:
  pull_request:

jobs:
  backend-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Backend smoke / tests (skip if no backend)
        shell: bash
        run: |
          set -e
          if [ ! -d backend ]; then
            echo "No backend/ directory yet. Skipping backend-tests."
            exit 0
          fi
          cd backend
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ -f pytest.ini ] || [ -d tests ]; then pytest -q; else echo "No backend tests found."; fi

  frontend-smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Validate script/style paths
        run: |
          set -e
          if grep -R "\.\./components/" -n docs/frontend/pages/recording.html; then
            echo "recording.html still references ../components/. Use ../scripts/." >&2
            exit 1
          fi
          # Ensure referenced CSS files exist
          (test -f docs/frontend/styles/customColorsStyle.css || test -f docs/frontend/styles/styles.css)
          (test -f docs/frontend/styles/recordingStyle.css || test -f docs/frontend/styles/styles.css)